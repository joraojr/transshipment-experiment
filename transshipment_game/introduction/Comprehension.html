{% block title %}
    Comprehension Questions
{% endblock %}

{% block content %}
    <div>
        <p>
            After this section, you will start the experiment. Before, we would like to ask you a few questions to make sure you understand the
            rules of the game. Please answer the following questions to the best of your ability. If you answer incorrectly, you will be asked to try
            again.
        </p>
    </div>
    <br><br>
    <div>
        <div id="question_box"></div>

        <div id="answer_box"></div>

        <div id="prompt_box" class="alert"></div>

        <div id="next_box" style="text-align: right;">
            <button class="btn btn-primary next_question" style="text-align: right;" disabled>Next</button>
        </div>

    </div>
    <div id="next_box" style="text-align: right;">
        <button class="otree-btn-next btn btn-primary" style="display: none;">Start Experiment</button>
    </div>


    <style type="text/css">
        body {
            padding-bottom: 50px;
        }

        label {
            padding-left: 5px;
        }

        #answer_box {
            display: flex;
            flex-flow: column;
            margin-bottom: 10px;
        }

        .answer_option {
            cursor: pointer;
            padding: 20px;
            display: flex;
            align-items: center;
        }

        .answer_option:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .answer_option label {
            cursor: pointer !important;
        }

        #question_box {
            margin-bottom: 10px;
            font-size: 20px;
        }

        #prompt_box {
            display: none;
        }

        #next_box {
            min-height: 40px;
            width: 100%;
        }

        #next_box .btn {
            float: right;
        }
    </style>

    <script type="text/javascript">

        $(document).ready(function () {

            {# Modify this array to include additional comprehension question#}

            var questions = [
                "Comprehension Question 1",
                "Comprehension Question 2",
                "Comprehension Question 3",
                "Comprehension Question 4",
                "Comprehension Question 5"
            ];

            var answers_data = {
                "first": {
                    "answers": [
                        "Comprehension Answer 1",
                        "Comprehension Answer 2",
                        "Comprehension Answer 3"
                    ],
                    "correct": 1,
                    "prompts": ["This answer is incorrect. Please correct your answer.", "Your answer is correct.", "This answer is incorrect. Please correct your answer."],
                    "showtable": false
                },
                "second": {
                    "answers": [
                        "Comprehension Answer 1",
                        "Comprehension Answer 2"]
                    ,
                    "correct": 1,
                    "prompts": ["Your answer is correct", "This answer is incorrect. Please correct your answer."],
                    "showtable": false
                },
                "third": {
                    "answers": [
                        "Comprehension Answer 1",
                        "Comprehension Answer 2"
                    ],
                    "correct": 1,
                    "prompts": ["This answer is incorrect. Please correct your answer.", "Your answer is correct."],
                    "showtable": false
                },
                "fourth": {
                    "answers": [
                        "Comprehension Answer 1",
                        "Comprehension Answer 2",
                        "Comprehension Answer 3"
                    ],
                    "correct": 0,
                    "prompts": ["Your answer is correct.", "This answer is incorrect. Please correct your answer.", "This answer is incorrect. Please correct your answer."],
                    "showtable": false
                },
                "fifth": {
                    "answers": [
                        "Comprehension Answer 1",
                        "Comprehension Answer 2",
                        "Comprehension Answer 3"
                    ],
                    "correct": 1,
                    "prompts": ["This answer is incorrect. Please correct your answer.", "Your answer is correct.", "This answer is incorrect. Please correct your answer."],
                    "showtable": false
                }
            };


            var data_keys = Object.keys(answers_data);

            var i = 0;
            var limit = data_keys.length - 1;
            var current_key;
            var current_data;
            var selected_option;
            var answers_length;
            var current_answers;

            function showQuestions() {
                $("#answer_box input").prop("checked", false);
                $(".next_question").prop('disabled', true);

                current_key = data_keys[i];
                current_data = answers_data[current_key];
                $("#question_box").html(questions[i]);
                current_answers = current_data["answers"];
                answers_length = current_answers.length;

                $("#answer_box").empty();
                $("#prompt_box").empty();
                $("#prompt_box").removeClass("alert-success");
                $("#prompt_box").removeClass("alert-danger");
                $("#prompt_box").hide();

                // liveSend({'which_option': parseInt(1000), 'which_question': parseInt(i)});#}

                for (var j = 0; j < answers_length; j++) {
                    $("#answer_box").append('<div data-answer-option="' + j + '" class="answer_option"><input type="radio" name="radio_group" value="' + j + '"><label for="option' + j + '">' + current_answers[j] + '</label></div>');
                }

                if (i == limit) {
                    $(".next_question").hide();
                    $(".otree-btn-next").show();
                    $(".otree-btn-next").prop('disabled', true);
                }
            };

            $(document).ready(showQuestions());


            $(document).on("click", ".answer_option", function () {
                event.preventDefault();
                $(this).children("input").prop("checked", true);
                current_key = data_keys[i];
                current_data = answers_data[current_key];
                selected_option = $("#answer_box input[type='radio']:checked").val();
                correct_option = parseInt(current_data["correct"]);
                if ($("#answer_box input[type='radio']").is(":checked")) {
                    $("#prompt_box").removeClass("alert-danger").slideUp(200);
                    $(".next_question").prop('disabled', false);
                    $(".otree-btn-next").prop('disabled', false);
                } else {
                    $(".otree-btn-next").prop('disabled', true);
                    $(".next_question").prop('disabled', true);
                }
            });


            $(".next_question").on("click", function () {
                $("#prompt_box").html(current_data["prompts"][selected_option]);
                if (selected_option != correct_option) {
                    event.preventDefault();
                    $("#prompt_box").removeClass("alert-success").addClass("alert-danger").slideDown(200);
                } else {
                    i = i + 1;
                    showQuestions()
                }

            });

            $(".otree-btn-next").on("click", function () {
                $("#prompt_box").html(current_data["prompts"][selected_option]);
                if (selected_option != correct_option) {
                    event.preventDefault();
                    $("#prompt_box").removeClass("alert-success").addClass("alert-danger").slideDown(200);
                }
            });


        });

    </script>

{% endblock %}

{{ block content }}

{% comment %}

  TODO make this code less messy!

{% endcomment %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>Understanding</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

</head>

<h2>Comprehension Questions</h2>
<div>
    <p>
        After this section, you will start the experiment. Before you start, we would like to ask you a few questions to make sure you understand the
        rules of the game. Please answer the following questions to the best of your ability. If you answer incorrectly, you will be asked to try
        again.
    </p>
</div>
<br><br>
<div>
    {#First question goes here#}

    <div id="question_box">CQ1</div>

    <div id="answer_box">
        <div data-answer-option="0" class="answer_option">
            <input type="radio" name="radio_group" value="0">
            <label for="option0">Comprehension Answer 1</label>
        </div>
        <div data-answer-option="1" class="answer_option">
            <input type="radio" name="radio_group" value="1">
            <label for="option1">Comprehension Answer 2</label>
        </div>
        <div data-answer-option="2" class="answer_option">
            <input type="radio" name="radio_group" value="2">
            <label for="option2">Comprehension Answer 3</label>
        </div>
    </div>

    <div id="prompt_box" class="alert"></div>

    <div id="next_box">
        <button class="btn btn-primary next_question" style="" disabled>Next</button>
    </div>

</div>

<button class="otree-btn-next btn btn-primary" style="display: none;">Start Experiment</button>


<style type="text/css">
    body {
        padding-bottom: 50px;
    }

    label {
        padding-left: 5px;
    }

    .otree-timer {
        display: none !important;
    }

    #answer_box {
        display: flex;
        flex-flow: column;
        margin-bottom: 10px;
    }

    .answer_option {
        cursor: pointer;
        padding: 20px;
    }

    .answer_option:hover {
        background: rgba(0, 0, 0, 0.1);
    }

    .answer_option label {
        cursor: pointer !important;
    }

    #table_box {
        display: none;
        margin-bottom: 10px;
    }

    #question_box {
        margin-bottom: 10px;
        font-size: 20px;
    }

    #prompt_box {
        display: none;
    }

    #next_box {
        min-height: 40px;
        width: 100%;
    }

    #next_box .btn {
        float: left;
    }
</style>

<script type="text/javascript">

    $(document).ready(function () {

        var questions = [
            "Comprehension Question 1",
            "Comprehension Question 2",
            "Comprehension Question 3",
            "Comprehension Question 4",
            "Comprehension Question 5"
        ];

        var answers_data = {
            "first": {
                "answers": [
                    "Comprehension Answer 1",
                    "Comprehension Answer 2",
                    "Comprehension Answer 3"
                ],
                "correct": 1,
                "prompts": ["This answer is incorrect. Please correct your answer.", "Your answer is correct.", "This answer is incorrect. Please correct your answer."],
                "showtable": false
            },
            "second": {
                "answers": [
                    "Comprehension Answer 1",
                    "Comprehension Answer 2"]
                ,
                "correct": 1,
                "prompts": ["Your answer is correct", "This answer is incorrect. Please correct your answer."],
                "showtable": false
            },
            "third": {
                "answers": [
                    "Comprehension Answer 1",
                    "Comprehension Answer 2"
                ],
                "correct": 1,
                "prompts": ["This answer is incorrect. Please correct your answer.", "Your answer is correct."],
                "showtable": false
            },
            "fourth": {
                "answers": [
                    "Comprehension Answer 1",
                    "Comprehension Answer 2",
                    "Comprehension Answer 3"
                ],
                "correct": 0,
                "prompts": ["Your answer is correct.", "This answer is incorrect. Please correct your answer.", "This answer is incorrect. Please correct your answer."],
                "showtable": false
            },
            "fifth": {
                "answers": [
                    "Comprehension Answer 1",
                    "Comprehension Answer 2",
                    "Comprehension Answer 3"
                ],
                "correct": 1,
                "prompts": ["This answer is incorrect. Please correct your answer.", "Your answer is correct.", "This answer is incorrect. Please correct your answer."],
                "showtable": false
            }
        };


        var data_keys = Object.keys(answers_data);

        var i = 0;
        var limit = 4;
        var current_key;
        var current_data;
        var selected_option;
        var answers_length;
        var current_answers;

        $(document).on("click", ".answer_option", function () {
            event.preventDefault();
            $(this).children("input").prop("checked", true);
            $("#prompt_box").slideDown(200);
            current_key = data_keys[i];
            current_data = answers_data[current_key];
            selected_option = $("#answer_box input[type='radio']:checked").val();
            $("#prompt_box").html(current_data["prompts"][selected_option]);
            correct_option = parseInt(current_data["correct"]);
            if (selected_option == correct_option) {
                $("#prompt_box").removeClass("alert-danger");
                $("#prompt_box").addClass("alert-success");
                $(".next_question").prop('disabled', false);
                $(".otree-btn-next").prop('disabled', false);
            } else {
                $("#prompt_box").removeClass("alert-success");
                $("#prompt_box").addClass("alert-danger");
                $(".otree-btn-next").prop('disabled', true);
                $(".next_question").prop('disabled', true);
            }
            {#liveSend({'which_option': parseInt(selected_option), 'which_question': parseInt(i)});#}
        });

        $(".next_question").on("click", function () {
            event.preventDefault(); // Preventing from the form to be executed
            $("#answer_box input").prop("checked", false);
            $(".next_question").prop('disabled', true);
            i = i + 1; // Starts from the second question!
            current_key = data_keys[i];
            current_data = answers_data[current_key];
            $("#question_box").html(questions[i]);
            current_answers = current_data["answers"];
            answers_length = current_answers.length;
            $("#answer_box").empty();
            $("#prompt_box").empty();
            $("#prompt_box").removeClass("alert-success");
            $("#prompt_box").removeClass("alert-danger");
            $("#prompt_box").hide();
            {#liveSend({'which_option': parseInt(1000), 'which_question': parseInt(i)});#}
            if (current_data["showtable"]) {
                $("#table_box").show(300);
            }
            for (var j = 0; j < answers_length; j++) {
                $("#answer_box").append('<div data-answer-option="' + j + '" class="answer_option"><input type="radio" name="radio_group" value="' + j + '"><label for="option' + j + '">' + current_answers[j] + '</label></div>');
            }

            if (i == limit) {
                $(this).hide();
                $(".otree-btn-next").show();
                $(".otree-btn-next").prop('disabled', true);
            }

        });


    });

</script>

{{ endblock }}
